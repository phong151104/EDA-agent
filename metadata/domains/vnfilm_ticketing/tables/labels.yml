catalog: lakehouse
schema: lh_vnfilm_v2
table_name: labels
domain: vnfilm_ticketing

table_type: dim
business_name: "Dimension nhãn nội dung/label theo vendor"
grain: "1 dòng = 1 label do vendor định nghĩa (content + thời hạn hiệu lực)"

description: >
  Bảng labels chứa các nhãn (label) hiển thị nội dung cho ứng dụng: text, mô tả, thứ tự hiển thị,
  thời gian hiệu lực, trạng thái và loại nội dung. Mỗi bản ghi có thể gắn với một vendor tương ứng.
  Dùng để hiển thị nội dung động (banner/text/label) theo từng vendor hoặc trong từng khung thời gian.

tags:
  - dim
  - label
  - content
  - vendor
  - vnfilm

primary_key:
  - id

foreign_keys:
  - column: vendor_id
    references_table: "lakehouse.lh_vnfilm_v2.vendor"
    references_column: "id"
    relation: "many_to_one"
    description: "Vendor sở hữu/định nghĩa label này."

time_columns:
  - active_from_date
  - active_to_date
  - created_date
  - modified_date

recommended_filters:
  - "vendor_id để phân tích nội dung theo vendor"
  - "status để lọc label ACTIVE"
  - "active_from_date / active_to_date để lọc theo thời gian hiệu lực"
  - "type để phân nhóm label (banner, text, html...)"

concepts:
  - name: label
    synonyms: ["label", "text", "nội dung", "display label", "metadata label"]

  - name: content
    synonyms: ["nội dung", "content", "text", "message", "hiển thị"]

  - name: vendor
    synonyms: ["nhà cung cấp", "đối tác", "merchant", "vendor"]

columns:
  id:
    data_type: bigint
    business_name: "ID label"
    description: "Khóa chính của bảng labels."
    semantics: [id, primary, label]
    pii: false

  content:
    data_type: varchar
    business_name: "Nội dung label"
    description: "Text nội dung hiển thị."
    semantics: [content, text, label]

  description:
    data_type: varchar
    business_name: "Mô tả label"
    description: "Mô tả chi tiết hơn về label."
    semantics: [description, text]

  position:
    data_type: varchar
    business_name: "Vị trí hiển thị"
    description: "Vị trí mà label được hiển thị (UI position)."
    semantics: [position, ui]

  vendor_id:
    data_type: bigint
    business_name: "ID vendor"
    description: "Vendor định nghĩa label này."
    semantics: [id, vendor]
    pii: false

  active_from_date:
    data_type: timestamp(6)
    business_name: "Ngày bắt đầu hiệu lực"
    description: "Thời điểm label bắt đầu có hiệu lực."
    semantics: [date, effect_start]

  active_to_date:
    data_type: timestamp(6)
    business_name: "Ngày kết thúc hiệu lực"
    description: "Thời điểm label hết hiệu lực."
    semantics: [date, effect_end]

  active_day_of_week:
    data_type: varchar
    business_name: "Ngày hiệu lực trong tuần"
    description: "Một hoặc nhiều ngày trong tuần mà label có hiệu lực."
    semantics: [day_of_week, schedule]

  status:
    data_type: varchar
    business_name: "Trạng thái"
    description: "Trạng thái label (ACTIVE/INACTIVE)."
    semantics: [status]

  created_date:
    data_type: timestamp(6)
    business_name: "Thời điểm tạo"
    description: "Thời điểm bản ghi được tạo."
    semantics: [date, created_time]

  created_by:
    data_type: varchar
    business_name: "Người tạo"
    description: "User/service tạo label."
    semantics: [user_identity, creator, raw]
    pii: true
    sensitive: true

  modified_date:
    data_type: timestamp(6)
    business_name: "Thời điểm cập nhật"
    description: "Thời điểm cập nhật gần nhất."
    semantics: [date, modified_time]

  modified_by:
    data_type: varchar
    business_name: "Người cập nhật"
    description: "User/service cập nhật label."
    semantics: [user_identity, modifier, raw]
    pii: true
    sensitive: true

  modified_by_hash:
    data_type: varchar
    business_name: "Hash người cập nhật"
    description: "Hash của modified_by (phục vụ RLS)."
    semantics: [user_identity, hash]

  display_order:
    data_type: integer
    business_name: "Thứ tự hiển thị"
    description: "Thứ tự sắp xếp label trong UI."
    semantics: [order, display]

  name:
    data_type: varchar
    business_name: "Tên label"
    description: "Tên định danh của label."
    semantics: [name, label]

  type:
    data_type: varchar
    business_name: "Loại label"
    description: "Loại nội dung: text, html, banner…"
    semantics: [type, content]

  content_html:
    data_type: varchar
    business_name: "Nội dung HTML"
    description: "HTML hiển thị của label (nếu type=html)."
    semantics: [html, content]

guardrails:
  sql:
    read_only: true
    require_limit: true
    default_limit: 200
    forbid_select_star: false
    preferred_time_filter: "active_from_date"
    allowed_time_columns:
      - active_from_date
      - active_to_date
      - created_date
      - modified_date
    forbidden_columns:
      - created_by
      - modified_by

sample_questions:
  - "Những label nào đang ACTIVE cho vendor X?"
  - "Danh sách label đang có hiệu lực hôm nay?"
  - "Label có name = 'HotDealBanner' đang hiển thị nội dung gì?"
  - "Vendor nào có nhiều label active nhất?"
  - "Danh sách label có loại HTML?"

sample_queries:
  - description: "Các label ACTIVE hiện tại"
    sql: |
      SELECT
        id,
        name,
        content,
        vendor_id,
        status
      FROM lakehouse.lh_vnfilm_v2.labels
      WHERE status = 'ACTIVE'
        AND (active_from_date IS NULL OR active_from_date <= now())
        AND (active_to_date IS NULL OR active_to_date >= now())
      ORDER BY display_order
      LIMIT 200;

  - description: "Label theo vendor"
    sql: |
      SELECT
        vendor_id,
        name,
        content,
        status
      FROM lakehouse.lh_vnfilm_v2.labels
      WHERE vendor_id = 123
      ORDER BY display_order
      LIMIT 200;
