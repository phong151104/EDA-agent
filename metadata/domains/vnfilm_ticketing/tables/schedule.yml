catalog: lakehouse
schema: lh_vnfilm_v2
table_name: schedule
domain: vnfilm_ticketing

table_type: fact_notification
business_name: "Bảng đăng ký nhận thông báo phim (Schedule/Notify Me)"
grain: "1 dòng = 1 khách hàng đăng ký nhận thông báo cho 1 phim."

description: >
  Bảng schedule lưu trữ thông tin khách hàng đăng ký nhận thông báo về các bộ phim sắp chiếu (Coming Soon).
  Hệ thống sẽ dùng bảng này để gửi email/notification nhắc nhở khách hàng khi phim bắt đầu mở bán vé hoặc công chiếu.

tags:
  - fact
  - notification
  - customer_interest
  - coming_soon
  - vnfilm

primary_key:
  - id

foreign_keys:
  - column: bank_id
    references_table: "lakehouse.lh_vnfilm_v2.bank"
    references_column: "id"
    relation: "many_to_one"
    description: "Join sang bảng bank để xác định nguồn khách hàng."

  - column: film_id
    references_table: "lakehouse.lh_vnfilm_v2.film"
    references_column: "id"
    relation: "many_to_one"
    description: "Join sang bảng film để biết khách quan tâm phim nào."

time_columns:
  - created_date

recommended_filters:
  - "schedule_status để lọc các yêu cầu đang chờ gửi (comingSoon/wait)"
  - "film_id để thống kê mức độ quan tâm của khán giả đối với phim sắp chiếu"
  - "created_date để theo dõi xu hướng đăng ký theo thời gian"

concepts:
  - name: notify_me
    synonyms: ["nhắc lịch", "báo phim", "quan tâm"]
  - name: interest
    synonyms: ["nhu cầu", "demand"]

columns:
  id:
    data_type: bigint
    business_name: "ID bản ghi"
    description: "Mã định danh duy nhất của yêu cầu thông báo."
    semantics: [id, primary]
    pii: false

  bank_id:
    data_type: bigint
    business_name: "ID Ngân hàng"
    description: "Mã định danh ngân hàng."
    semantics: [id, bank]

  film_id:
    data_type: bigint
    business_name: "ID Phim"
    description: "Mã định danh phim khách hàng quan tâm."
    semantics: [id, film]

  schedule_status:
    data_type: varchar
    business_name: "Trạng thái thông báo"
    description: "Trạng thái xử lý thông báo (comingSoon: Chưa chiếu, wait: Chờ gửi, sent: Đã gửi)."
    semantics: [status, notification_state]

  status:
    data_type: varchar
    business_name: "Trạng thái (Legacy)"
    description: "Trạng thái chung của bản ghi (thường null hoặc active/inactive)."
    semantics: [status, legacy]

  bank_identity:
    data_type: varchar
    business_name: "User ID (Bank)"
    description: "Định danh khách hàng (SĐT/Email) để gửi thông báo."
    semantics: [user_identity, contact_info]
    pii: true
    sensitive: true

  bank_identity_hash:
    data_type: varchar
    business_name: "User ID Hash"
    description: "Mã hash định danh khách hàng."
    semantics: [user_identity, contact_info, hash]
    pii: false

  created_date:
    data_type: timestamp(6)
    business_name: "Ngày đăng ký"
    description: "Thời điểm khách hàng bấm đăng ký nhận tin."
    semantics: [date, created_time]

  created_by:
    data_type: varchar
    business_name: "Người tạo"
    description: "Hệ thống/API tạo bản ghi (Ví dụ: Search-API)."
    semantics: [user_identity, creator, raw]
    pii: true
    sensitive: true

  created_by_hash:
    data_type: varchar
    business_name: "Người tạo (Hash)"
    description: "Mã hash người tạo."
    semantics: [user_identity, creator, hash]
    pii: false

guardrails:
  sql:
    read_only: true
    require_limit: true
    default_limit: 100
    forbid_select_star: true
    preferred_time_filter: "created_date"
    forbidden_columns:
      - bank_identity
      - created_by

sample_questions:
  - "Có bao nhiêu người đăng ký nhận thông báo cho phim Zootopia 2?"
  - "Top 10 phim sắp chiếu được quan tâm nhiều nhất?"
  - "Danh sách user (hash) cần gửi thông báo trong ngày hôm nay?"

sample_queries:
  - description: "Top phim sắp chiếu (Coming Soon) được mong chờ nhất"
    sql: |
      SELECT
        f.film_name_vi,
        COUNT(s.id) as interest_count
      FROM lakehouse.lh_vnfilm_v2.schedule s
      JOIN lakehouse.lh_vnfilm_v2.film f ON s.film_id = f.id
      WHERE s.schedule_status = 'comingSoon'
      GROUP BY 1
      ORDER BY 2 DESC
      LIMIT 10