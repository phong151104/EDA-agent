catalog: lakehouse
schema: lh_vnfilm_v2
table_name: sub_campaign_condition
domain: vnfilm_ticketing

table_type: dim_extension
business_name: "Bảng điều kiện áp dụng chiến dịch (Conditions)"
grain: "1 dòng = 1 bộ quy tắc (Ruleset) áp dụng cho 1 Sub-Campaign."

description: >
  Bảng sub_campaign_condition lưu trữ các điều kiện lọc (Filters) chi tiết để xác định một đơn hàng có được hưởng khuyến mãi hay không.
  Cấu trúc dữ liệu chủ yếu là các cặp "Apply" (Danh sách cho phép - Whitelist) và "Exclude" (Danh sách chặn - Blacklist)
  đối với các thực thể như: Rạp, Phim, Phòng chiếu, Suất chiếu, Loại ghế, Ngày trong tuần, v.v.

tags:
  - dim_extension
  - rules_engine
  - conditions
  - targeting
  - whitelist_blacklist
  - vnfilm

primary_key:
  - id

foreign_keys:
  - column: id
    references_table: "lakehouse.lh_vnfilm_v2.sub_campaign"
    references_column: "id"
    relation: "one_to_one"
    description: "Mapping 1-1 với bảng Sub-Campaign (ID bảng này chính là ID Sub-Campaign)."

time_columns:
  - created_date
  - modified_date

recommended_filters:
  - "status = 'active' để lấy các bộ quy tắc đang hiệu lực"
  - "film_apply để tìm các chiến dịch dành riêng cho một phim cụ thể"
  - "booking_dow_apply để xem khuyến mãi áp dụng cho ngày nào trong tuần"

concepts:
  - name: whitelist
    synonyms: ["apply", "danh sách cho phép", "include"]
  - name: blacklist
    synonyms: ["exclude", "danh sách chặn", "loại trừ"]

columns:
  id:
    data_type: bigint
    business_name: "ID Sub-Campaign"
    description: "Mã định danh bản ghi (Trùng với ID của Sub-Campaign)."
    semantics: [id, primary, foreign_key]
    pii: false

  # --- BANK CONDITIONS ---
  bank_apply:
    data_type: varchar
    business_name: "Bank cho phép"
    description: "Danh sách mã ngân hàng được áp dụng (JSON Array)."
    semantics: [data, json, whitelist, bank]

  bank_exclude:
    data_type: varchar
    business_name: "Bank loại trừ"
    description: "Danh sách mã ngân hàng bị chặn (JSON Array)."
    semantics: [data, json, blacklist, bank]

  # --- CINEMA & LOCATION CONDITIONS ---
  cinema_apply:
    data_type: varchar
    business_name: "Rạp cho phép"
    description: "Danh sách mã rạp được áp dụng."
    semantics: [data, json, whitelist, cinema]

  cinema_exclude:
    data_type: varchar
    business_name: "Rạp loại trừ"
    description: "Danh sách mã rạp bị chặn."
    semantics: [data, json, blacklist, cinema]

  room_apply:
    data_type: varchar
    business_name: "Phòng chiếu cho phép"
    description: "Danh sách mã phòng chiếu được áp dụng."
    semantics: [data, json, whitelist, room]

  room_exclude:
    data_type: varchar
    business_name: "Phòng chiếu loại trừ"
    description: "Danh sách mã phòng chiếu bị chặn."
    semantics: [data, json, blacklist, room]

  # --- FILM CONDITIONS ---
  film_apply:
    data_type: varchar
    business_name: "Phim cho phép"
    description: "Danh sách mã phim (Vendor ID) được áp dụng."
    semantics: [data, json, whitelist, film]

  film_exclude:
    data_type: varchar
    business_name: "Phim loại trừ"
    description: "Danh sách mã phim (Vendor ID) bị chặn."
    semantics: [data, json, blacklist, film]

  # --- SESSION & TIME CONDITIONS ---
  session_apply:
    data_type: varchar
    business_name: "Suất chiếu cho phép"
    description: "Danh sách mã suất chiếu cụ thể được áp dụng."
    semantics: [data, json, whitelist, session]

  session_exclude:
    data_type: varchar
    business_name: "Suất chiếu loại trừ"
    description: "Danh sách mã suất chiếu bị chặn."
    semantics: [data, json, blacklist, session]

  booking_dow_apply:
    data_type: varchar
    business_name: "Thứ (Booking) cho phép"
    description: "Ngày trong tuần (Day of Week) cho phép đặt vé (VD: ['FRIDAY','SATURDAY'])."
    semantics: [data, json, whitelist, day_of_week]

  booking_dow_exclude:
    data_type: varchar
    business_name: "Thứ (Booking) loại trừ"
    description: "Ngày trong tuần không được phép đặt vé."
    semantics: [data, json, blacklist, day_of_week]

  session_dow_apply:
    data_type: varchar
    business_name: "Thứ (Suất chiếu) cho phép"
    description: "Ngày trong tuần của suất chiếu được áp dụng."
    semantics: [data, json, whitelist, day_of_week]

  session_dow_exclude:
    data_type: varchar
    business_name: "Thứ (Suất chiếu) loại trừ"
    description: "Ngày trong tuần của suất chiếu bị chặn."
    semantics: [data, json, blacklist, day_of_week]

  # --- FORMAT & VERSION CONDITIONS (New in Data) ---
  session_dimension_apply:
    data_type: varchar
    business_name: "Định dạng cho phép"
    description: "Định dạng phim cho phép (VD: ['Film2D', 'Film3D'])."
    semantics: [data, json, whitelist, dimension]

  session_dimension_exclude:
    data_type: varchar
    business_name: "Định dạng loại trừ"
    description: "Định dạng phim bị chặn."
    semantics: [data, json, blacklist, dimension]

  session_type_apply:
    data_type: varchar
    business_name: "Loại suất cho phép"
    description: "Loại suất chiếu cho phép (VD: nowShowing)."
    semantics: [data, json, whitelist, session_type]

  session_type_exclude:
    data_type: varchar
    business_name: "Loại suất loại trừ"
    description: "Loại suất chiếu bị chặn."
    semantics: [data, json, blacklist, session_type]

  session_version_type_apply:
    data_type: varchar
    business_name: "Phiên bản cho phép"
    description: "Phiên bản chi tiết cho phép (VD: ['VER_2D_SUB', 'VER_2D_DUB'])."
    semantics: [data, json, whitelist, version_type]

  session_version_type_exclude:
    data_type: varchar
    business_name: "Phiên bản loại trừ"
    description: "Phiên bản chi tiết bị chặn."
    semantics: [data, json, blacklist, version_type]

  is_sneak_show_apply:
    data_type: boolean
    business_name: "Áp dụng SneakShow"
    description: "Cờ bật/tắt áp dụng cho suất chiếu sớm."
    semantics: [flag, condition]

  # --- SEAT & CONCESSION CONDITIONS ---
  seat_apply:
    data_type: varchar
    business_name: "Loại ghế cho phép"
    description: "Danh sách loại ghế được áp dụng (VD: ['normal', 'vip'])."
    semantics: [data, json, whitelist, seat_type]

  seat_exclude:
    data_type: varchar
    business_name: "Loại ghế loại trừ"
    description: "Danh sách loại ghế bị chặn."
    semantics: [data, json, blacklist, seat_type]

  concession_apply:
    data_type: varchar
    business_name: "Combo cho phép"
    description: "Danh sách mã combo được áp dụng."
    semantics: [data, json, whitelist, concession]

  concession_exclude:
    data_type: varchar
    business_name: "Combo loại trừ"
    description: "Danh sách mã combo bị chặn."
    semantics: [data, json, blacklist, concession]

  # --- SYSTEM STATUS ---
  status:
    data_type: varchar
    business_name: "Trạng thái"
    description: "Trạng thái hoạt động của bộ điều kiện (active/inactive)."
    semantics: [status, active_state]

  created_date:
    data_type: timestamp(6)
    business_name: "Ngày tạo"
    description: "Thời điểm tạo bộ quy tắc."
    semantics: [date, created_time]

  created_by:
    data_type: varchar
    business_name: "Người tạo"
    description: "User tạo bản ghi."
    semantics: [user_identity, creator, raw]
    pii: true
    sensitive: true

  created_by_hash:
    data_type: varchar
    business_name: "Người tạo (Hash)"
    description: "Mã hash người tạo."
    semantics: [user_identity, creator, hash]
    pii: false

  modified_date:
    data_type: timestamp(6)
    business_name: "Ngày cập nhật"
    description: "Thời điểm cập nhật quy tắc lần cuối."
    semantics: [date, modified_time]

  modified_by:
    data_type: varchar
    business_name: "Người cập nhật"
    description: "User cập nhật bản ghi."
    semantics: [user_identity, modifier]

guardrails:
  sql:
    read_only: true
    require_limit: true
    default_limit: 100
    forbid_select_star: true
    preferred_time_filter: "created_date"
    forbidden_columns:
      - created_by

sample_questions:
  - "Những chiến dịch nào chỉ áp dụng cho phim 2D (Film2D)?"
  - "Tìm các điều kiện áp dụng cho ngày cuối tuần (FRIDAY, SATURDAY, SUNDAY)?"
  - "Danh sách phim (Vendor ID) bị loại trừ trong chiến dịch ID=1?"

sample_queries:
  - description: "Liệt kê các điều kiện áp dụng cho cuối tuần"
    sql: |
      SELECT
        id as sub_campaign_id,
        booking_dow_apply,
        seat_apply
      FROM lakehouse.lh_vnfilm_v2.sub_campaign_condition
      WHERE booking_dow_apply LIKE '%SATURDAY%' 
         OR booking_dow_apply LIKE '%SUNDAY%'
      ORDER BY id