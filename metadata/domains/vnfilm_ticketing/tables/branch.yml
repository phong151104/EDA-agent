catalog: lakehouse
schema: lh_vnfilm_v2
table_name: branch
domain: vnfilm_ticketing

table_type: dim
business_name: "Dimension chi nhánh/rạp theo vendor (branch)"
grain: "1 dòng = 1 chi nhánh/rạp thuộc một vendor"

description: >
  Bảng danh mục chi nhánh/rạp (branch) của từng vendor. Mỗi bản ghi tương ứng với một rạp/cụm rạp,
  bao gồm mã code và tên hiển thị (VI/EN), trạng thái hoạt động và thông tin tạo/cập nhật.
  Thường được dùng để phân tích doanh thu, số vé, đơn hàng theo từng rạp hoặc hệ thống rạp.

tags:
  - dim
  - cinema
  - branch
  - vendor
  - vnfilm

primary_key:
  - id

foreign_keys:
  - column: vendor_id
    references_table: "lakehouse.lh_vnfilm_v2.vendor"
    references_column: "id"
    relation: "many_to_one"
    description: "Vendor (hệ thống rạp) mà chi nhánh/branch này thuộc về."

time_columns:
  - created_date
  - modified_date

recommended_filters:
  - "status cho lọc theo chi nhánh đang hoạt động (ACTIVE/INACTIVE)"
  - "vendor_id cho phân tích theo từng hệ thống rạp/vendor"
  - "name_vi hoặc code để lọc cụ thể một chi nhánh"

concepts:
  - name: branch
    synonyms: ["chi nhánh", "rạp", "cụm rạp", "cinema branch", "branch"]

  - name: cinema
    synonyms: ["rạp", "cinema", "theater"]

  - name: vendor
    synonyms: ["nhà cung cấp", "hệ thống rạp", "merchant", "vendor"]

columns:
  id:
    data_type: bigint
    business_name: "ID chi nhánh/rạp"
    description: "Khóa chính của bảng branch."
    semantics: [id, primary, branch]
    pii: false

  name_vi:
    data_type: varchar
    business_name: "Tên chi nhánh (VI)"
    description: "Tên chi nhánh/rạp hiển thị bằng tiếng Việt."
    semantics: [name, branch, cinema, vi]

  name_en:
    data_type: varchar
    business_name: "Tên chi nhánh (EN)"
    description: "Tên chi nhánh/rạp hiển thị bằng tiếng Anh."
    semantics: [name, branch, cinema, en]

  code:
    data_type: varchar
    business_name: "Mã chi nhánh"
    description: "Mã code duy nhất đại diện cho chi nhánh/rạp."
    semantics: [code, branch, cinema]

  vendor_id:
    data_type: bigint
    business_name: "ID vendor"
    description: "ID vendor/hệ thống rạp mà chi nhánh thuộc về. Join sang vendor.id."
    semantics: [id, vendor, join_key]
    pii: false

  status:
    data_type: varchar
    business_name: "Trạng thái chi nhánh"
    description: "Trạng thái hoạt động của chi nhánh (ví dụ: ACTIVE, INACTIVE)."
    semantics: [status, branch]

  created_date:
    data_type: timestamp(6)
    business_name: "Thời điểm tạo"
    description: "Thời điểm bản ghi chi nhánh được tạo."
    semantics: [date, created_time]

  created_by:
    data_type: varchar
    business_name: "Người tạo"
    description: "User/service tạo bản ghi chi nhánh (raw)."
    semantics: [user_identity, creator, raw]
    pii: true
    sensitive: true

  modified_date:
    data_type: timestamp(6)
    business_name: "Thời điểm cập nhật"
    description: "Thời điểm bản ghi chi nhánh được cập nhật gần nhất."
    semantics: [date, modified_time]

  modified_by:
    data_type: varchar
    business_name: "Người cập nhật"
    description: "User/service cập nhật bản ghi chi nhánh."
    semantics: [user_identity, modifier, raw]
    pii: true
    sensitive: true

guardrails:
  sql:
    read_only: true
    require_limit: true
    default_limit: 200
    forbid_select_star: false
    preferred_time_filter: "created_date"
    allowed_time_columns:
      - created_date
      - modified_date
    forbidden_columns:
      - created_by
      - modified_by

sample_questions:
  - "Danh sách tất cả các chi nhánh/rạp đang ACTIVE theo từng vendor?"
  - "Có bao nhiêu chi nhánh đang hoạt động cho mỗi hệ thống rạp?"
  - "Chi nhánh có code = 'BR001' thuộc vendor nào?"
  - "Liệt kê tên rạp theo vendor_id = X?"

sample_queries:
  - description: "Thống kê số chi nhánh đang ACTIVE theo vendor"
    sql: |
      SELECT
        vendor_id,
        COUNT(*) AS active_branches
      FROM lakehouse.lh_vnfilm_v2.branch
      WHERE status = 'ACTIVE'
      GROUP BY vendor_id
      ORDER BY active_branches DESC

  - description: "Danh sách chi nhánh theo từng vendor"
    sql: |
      SELECT
        b.vendor_id,
        b.code,
        b.name_vi,
        b.status
      FROM lakehouse.lh_vnfilm_v2.branch b
      ORDER BY b.vendor_id, b.code
      LIMIT 200
