catalog: lakehouse
schema: lh_vnfilm_v2
table_name: bank_pay_source
domain: vnfilm_ticketing

table_type: dim
business_name: "Dimension nguồn thanh toán ngân hàng (bank_pay_source)"
grain: "1 dòng = 1 mã nguồn thanh toán (pay_source)"

description: >
  Bảng danh mục nguồn thanh toán của ngân hàng. Mỗi dòng tương ứng với một mã pay_source
  và tên hiển thị tương ứng, dùng để giải nghĩa các giá trị trong cột billing_pay_source
  của bảng orders (và các bảng fact liên quan khác).

tags:
  - dim
  - lookup
  - bank
  - payment_source
  - vnfilm

primary_key:
  - pay_source

foreign_keys: []   # bảng tra cứu nhỏ, không có khóa ngoại ra bảng khác

time_columns: []   # không có cột thời gian

recommended_filters:
  - "pay_source cho lọc chính xác theo mã nguồn thanh toán"
  - "pay_source_name cho lọc/lọc mờ theo tên hiển thị"

concepts:
  - name: bank_pay_source
    synonyms: ["nguồn thanh toán", "payment source", "pay source", "nguồn bank", "bank pay source"]

columns:
  pay_source:
    data_type: varchar
    business_name: "Mã nguồn thanh toán"
    description: "Mã code của nguồn thanh toán do ngân hàng/đối tác định nghĩa (primary key)."
    semantics: [id, code, payment_source, bank]
    pii: false

  pay_source_name:
    data_type: varchar
    business_name: "Tên nguồn thanh toán"
    description: "Tên hiển thị của nguồn thanh toán tương ứng với pay_source."
    semantics: [name, label, payment_source, bank]
    pii: false

guardrails:
  sql:
    read_only: true
    require_limit: true
    default_limit: 200
    forbid_select_star: false        # bảng nhỏ, cho phép select *
    preferred_time_filter: null
    allowed_time_columns: []
    forbidden_columns: []

sample_questions:
  - "Danh sách tất cả các nguồn thanh toán ngân hàng hiện có?"
  - "Nguồn thanh toán 'MOBILE_APP' có tên hiển thị là gì?"
  - "Liệt kê mã và tên nguồn thanh toán để join với bảng orders?"

sample_queries:
  - description: "Lấy danh sách toàn bộ nguồn thanh toán"
    sql: |
      SELECT
        pay_source,
        pay_source_name
      FROM lakehouse.lh_vnfilm_v2.bank_pay_source
      ORDER BY pay_source;

  - description: "Join orders với bank_pay_source để xem tên nguồn thanh toán"
    sql: |
      SELECT
        o.id,
        o.billing_pay_source,
        bps.pay_source_name AS billing_pay_source_name
      FROM lakehouse.lh_vnfilm_v2.orders o
      LEFT JOIN lakehouse.lh_vnfilm_v2.bank_pay_source bps
        ON o.billing_pay_source = bps.pay_source
      WHERE o.created_date >= date_trunc('day', current_date) - interval '7' day
      LIMIT 200;
